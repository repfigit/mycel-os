import { PublicKey } from '../crypto/public_key.js';
import { serializeMessage } from './schema.js';
export async function verifyMessage({ signerAccountId, signerPublicKey, payload, signature, provider, }) {
    const accessKey = await provider.viewAccessKey({
        accountId: signerAccountId,
        publicKey: signerPublicKey,
    });
    if (accessKey.permission !== 'FullAccess') {
        throw new Error(`Public key ${signerPublicKey.toString()} does not have FullAccess permission on account ${signerAccountId}`);
    }
    const pk = PublicKey.from(signerPublicKey);
    const message = serializeMessage(payload);
    const isVerified = pk.verify(message, signature);
    if (!isVerified) {
        throw new Error('Signature verification failed');
    }
}
